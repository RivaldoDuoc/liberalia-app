<!----------------------------------------------------------------------------
   Plantilla de definición de nueva contraseña:

   - Extiende "base.html" para mantener estilos y estructura comunes.
   - Permite al usuario establecer una nueva contraseña tras un enlace válido de recuperación.
   - Incluye validación de campos, confirmación de contraseña y feedback de errores.
   - Proporciona funcionalidad de mostrar/ocultar contraseña con iconos interactivos.
   - Muestra un mensaje alternativo si el enlace es inválido o expirado, con opción para solicitar uno nuevo.
# ----------------------------------------------------------------------------->



{% extends "base.html" %}
{% block title %}Nueva contraseña - Liberalia{% endblock %}
{% block content %}
<div class="card shadow-sm auth-card p-3 p-md-4">
  {% if validlink %}
    <h5 class="text-center mb-3">Define tu nueva contraseña</h5>
    <form method="post" class="needs-validation" novalidate>
      {% csrf_token %}

      <!-- Nueva contraseña -->
      <div class="mb-3 position-relative">
        <input type="password" name="new_password1" id="id_new_password1"
               class="form-control pe-5" placeholder="Nueva contraseña"
               aria-label="Nueva contraseña" required autocomplete="new-password" minlength="6">
        <i class="bi bi-eye password-toggle position-absolute top-50 end-0 translate-middle-y me-3"
           id="toggleNewPassword1" style="cursor: pointer;"></i>
        <div class="invalid-feedback">Ingresa una contraseña válida (mínimo 6 caracteres).</div>
      </div>

      <!-- Confirmar nueva contraseña -->
      <div class="mb-3 position-relative">
        <input type="password" name="new_password2" id="id_new_password2"
               class="form-control pe-5" placeholder="Confirmar nueva contraseña"
               aria-label="Confirmar nueva contraseña" required autocomplete="new-password" minlength="6">
        <i class="bi bi-eye password-toggle position-absolute top-50 end-0 translate-middle-y me-3"
           id="toggleNewPassword2" style="cursor: pointer;"></i>
        <div class="invalid-feedback">Debes confirmar la contraseña.</div>
      </div>

      <!-- Botón submit -->
      <div class="d-grid">
        <button type="submit" class="btn btn-dark rounded-4 py-2">Guardar</button>
      </div>
    </form>
  {% else %}
    <h5 class="text-center mb-2">Enlace no válido o expirado</h5>
    <p class="text-center text-muted">Solicita un nuevo enlace de recuperación.</p>
    <div class="d-grid">
      <a class="btn btn-dark rounded-4 py-2" href="{% url 'password_reset' %}">Solicitar nuevamente</a>
    </div>
  {% endif %}
</div>

<!-- Script para alternar contraseña mientras se presiona -->
<script>
  function enablePasswordToggle(fieldId, iconId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(iconId);

    icon.addEventListener("mousedown", function() {
      field.type = "text";
      icon.classList.remove("bi-eye");
      icon.classList.add("bi-eye-slash");
    });

    icon.addEventListener("mouseup", function() {
      field.type = "password";
      icon.classList.remove("bi-eye-slash");
      icon.classList.add("bi-eye");
    });

    icon.addEventListener("mouseleave", function() {
      field.type = "password";
      icon.classList.remove("bi-eye-slash");
      icon.classList.add("bi-eye");
    });
  }

  enablePasswordToggle("id_new_password1", "toggleNewPassword1");
  enablePasswordToggle("id_new_password2", "toggleNewPassword2");
</script>
{% endblock %}
